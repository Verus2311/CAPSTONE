<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Appointment Details</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        .card {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            border: none;
            margin-bottom: 1rem;
        }
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        .detail-label {
            font-weight: 600;
            color: #6c757d;
        }
        .detail-value {
            color: #212529;
        }
        .status-badge {
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
        }
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        .service-item {
            background-color: #f8f9fa;
            padding: 0.75rem;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
        }
        .therapist-badge {
            background-color: #e9ecef;
            color: #495057;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="mb-0">Appointment Details</h3>
                <a href="index.html" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to List
                </a>
            </div>
            <div class="card-body">
                <!-- Loading Spinner -->
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>

                <!-- Appointment Details -->
                <div id="appointment-details" style="display: none;">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="mb-0">Personal Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="detail-label">Name</div>
                                        <div class="detail-value" id="name"></div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="detail-label">Age</div>
                                        <div class="detail-value" id="age"></div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="detail-label">Contact</div>
                                        <div class="detail-value" id="contact"></div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="detail-label">Gender</div>
                                        <div class="detail-value" id="gender"></div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="detail-label">Date of Birth</div>
                                        <div class="detail-value" id="dob"></div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="detail-label">Address</div>
                                        <div class="detail-value" id="address"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="mb-0">Appointment Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="detail-label">Status</div>
                                        <div class="detail-value">
                                            <span id="status" class="status-badge"></span>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="detail-label">Schedule</div>
                                        <div class="detail-value" id="date_sched"></div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="detail-label">Services</div>
                                        <div id="services" class="detail-value"></div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="detail-label">Ailment</div>
                                        <div class="detail-value" id="ailment"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase -->
    <script type="module">
        import { db } from './firebase-config.js';
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

        // Function to format date
        function formatDate(dateString) {
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // Function to get status badge class
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'pending':
                    return 'bg-warning';
                case 'approved':
                    return 'bg-success';
                case 'cancelled':
                    return 'bg-danger';
                default:
                    return 'bg-secondary';
            }
        }

        // Function to show error message
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger';
            errorDiv.textContent = message;
            document.querySelector('.card-body').appendChild(errorDiv);
        }

        // Get appointment ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const appointmentId = urlParams.get('id');

        if (!appointmentId) {
            showError('No appointment ID provided');
            document.querySelector('.loading-spinner').style.display = 'none';
        } else {
            // Fetch appointment details
            const docRef = doc(db, 'appointments', appointmentId);
            getDoc(docRef)
                .then((doc) => {
                    document.querySelector('.loading-spinner').style.display = 'none';
                    
                    if (doc.exists()) {
                        const data = doc.data();
                        
                        // Populate personal information
                        document.getElementById('name').textContent = data.name;
                        document.getElementById('age').textContent = data.age;
                        document.getElementById('contact').textContent = data.contact;
                        document.getElementById('gender').textContent = data.gender;
                        document.getElementById('dob').textContent = data.dob;
                        document.getElementById('address').textContent = data.address;

                        // Populate appointment information
                        const statusBadge = document.getElementById('status');
                        statusBadge.textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
                        statusBadge.className = `status-badge ${getStatusBadgeClass(data.status)}`;
                        
                        document.getElementById('date_sched').textContent = formatDate(data.date_sched);
                        document.getElementById('ailment').textContent = data.ailment;

                        // Populate services and therapists
                        const servicesContainer = document.getElementById('services');
                        if (Array.isArray(data.services) && Array.isArray(data.therapists)) {
                            data.services.forEach((service, index) => {
                                const serviceDiv = document.createElement('div');
                                serviceDiv.className = 'service-item';
                                serviceDiv.innerHTML = `
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>${service}</div>
                                        <span class="therapist-badge">${data.therapists[index]}</span>
                                    </div>
                                `;
                                servicesContainer.appendChild(serviceDiv);
                            });
                        }

                        // Show the details
                        document.getElementById('appointment-details').style.display = 'block';
                    } else {
                        showError('Appointment not found');
                    }
                })
                .catch((error) => {
                    console.error('Error loading appointment:', error);
                    document.querySelector('.loading-spinner').style.display = 'none';
                    showError('Error loading appointment details');
                });
        }
    </script>
</body>
</html> 